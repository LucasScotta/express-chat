<!DOCTYPE html>
<html>
<style>
  .status {
    border: 1px solid gray;
  }
  a {
    color: rebeccapurple;
    text-decoration: none;
    cursor: pointer;
  }
  ul {
    list-style: none;
  }
  #pagesLogged {
    visibility: hidden;
  }
</style>
<head>
    <title>Home</title>
</head>
<body id="body">
  <center>
    <div id="container">
      <span>Welcome</span>
      <span id="userName"></span>
      <a method="post"></a>
    </div>
  </center>
  <div id="pagesLogged">
    <ul>
      <li>
        <a href="chat.html">Chat</a>
      </li>
    </ul>
  </div>
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  const disconnect = () => {
    axios
      .get('/api/logout')
      .then((resp) => {
        if (resp.request.readyState === 4) {
          location.href = '/'
        }
      })
  }

  const createElement = (element) => document.createElement(element)
  const appendChild = (append, element) => append.appendChild(element)
  const logButton = (text, url, fn) => {
    const span = createElement('span')
    const a = createElement('a')
    if (url) {
      a.href = url
    }
    a.innerText = text
    a.className = 'status'
    if (fn) {
      a.onclick = fn
    }
    appendChild(container, span)
    appendChild(span, a)
  }

  const getUser = () => {
    const container = document.getElementById('container')
    const userName = document.getElementById('userName')
    axios
      .get('/user')
      .then((resp) => {
        if (resp.data.user) {
          userName.innerText = resp.data.user
          logButton('Disconnect', null, disconnect)
          document.getElementById('pagesLogged').style.visibility = 'visible'
        }
        else {
          logButton('Loggin', 'loggin.html')
        }
      })
    }
    getUser()
</script>
</html>
